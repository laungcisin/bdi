<div id="loading" style="position: absolute; z-index: 1000; top: 0px; left: 0px; width: 100%; height: 100%; background: #DDDDDB; text-align: center; padding-top: 20%;"></div>

<form id="addDatasourceForm" method="post">
    <!--数据源连接详情-->
    <input type="hidden" name="datasourceConnect" id="datasourceConnect"/>

    <table>
        <tr>
            <th>数据源名称：</th>
            <td>
                <input name="bdiDatasourceName" id="bdiDatasourceName"/>
            </td>
        </tr>
        <tr>
            <th>数据源类型：</th>
            <td>
                <input name="bdiDatasourceTypeId" id="bdiDatasourceTypeId"/>
            </td>
        </tr>
        <tr>
            <th>主机IP地址：</th>
            <td>
                <input name="ip" id="ip">
            </td>
        </tr>
        <tr>
            <th>端口号：</th>
            <td>
                <input name="port" id="port">
            </td>
        </tr>
        <tr>
            <th>用户名：</th>
            <td>
                <input name="username" id="username">
            </td>
        </tr>
        <tr>
            <th>密码：</th>
            <td>
                <input name="password" id="password">
            </td>
        </tr>
        <tr>
            <th>数据库：</th>
            <td>
                <input name="schemata" id="schemata">
            </td>
        </tr>
        <tr>
            <th>备注：</th>
            <td>
                <input name="remarks" id="remarks">
            </td>
        </tr>
    </table>
</form>


<script type="text/javascript">
    function show() {
        $("#loading").fadeOut("normal", function () {
            $(this).remove();
        });
    }
    var delayTime;
    $.parser.onComplete = function () {
        if (delayTime) {
            clearTimeout(delayTime);
        }

        delayTime = setTimeout(show, 100);
    }

    $(function () {
        initAddSdtBdiDialog();
    })


    /**
     * 初始化新增窗口。
     */
    function initAddSdtBdiDialog() {
        //数据源名称
        $('#bdiDatasourceName').textbox({
            editable: true,
            readonly: false,
            required: true,
            value: '172.16.0.103-mysql数据源'
        });

        //数据源类型
        $('#bdiDatasourceTypeId').combobox({
            url: '/sdt/datasourceForList',
            editable: false,
            required: true,
            method: 'get',
            valueField: 'id',
            textField: 'text',
            panelHeight: 'auto',
            multiple: false,
            value: '1'
        });

        //指标库备注
        $('#remarks').textbox({
            editable: true,
            height: '80px',
            required: true,
            readonly: false,
            multiline: true,
            value: '172.16.0.103-mysql数据源'
        });

        //----以下信息保存以json格式保存，datasourceConnect字段存储这些配置信息
        //主机IP地址
        $('#ip').textbox({
            editable: true,
            readonly: false,
            required: true,
            value: '172.16.0.103'
        });

        //端口号
        $('#port').textbox({
            editable: true,
            readonly: false,
            required: true,
            value: '3306'
        });

        //用户名
        $('#username').textbox({
            editable: true,
            readonly: false,
            required: true,
            value: 'gbdp'
        });

        //密码
        $('#password').textbox({
            editable: true,
            readonly: false,
            required: true,
            value: 'bdx123'
        });

        //数据源库
        $('#schemata').combobox({
            url: '',
            editable: false,
            required: true,
            method: 'get',
            valueField: 'id',
            textField: 'text',
            panelHeight: 'auto',
            panelMaxWidth: '500px',
            panelMaxHeight: '150px',
            multiple: false,
            onShowPanel: function () {
                $('#schemata').combobox("clear");

                var dataInfo = {
                    ip: $("#ip").val(),
                    port: $("#port").val(),
                    username: $("#username").val(),
                    password: $("#password").val(),
                    databaseType: $('#bdiDatasourceTypeId').combobox('getText')
                };

                $.ajax({
                    url: '/datasource/check',
                    async: false,
                    cache: false,
                    type: "GET",
                    data: dataInfo,
                    success: function (data) {
                        $('#schemata').combobox("clear");

                        if (data.success == "true" || data.success) {
                            $('#schemata').combobox('loadData', data.databaseInfo);
                        } else {
                            $('#schemata').combobox('loadData', '');
                            $.messager.alert('提示信息', data.message);
                        }
                    },
                    dataType: 'json'
                });
            }
        });
    }
</script>